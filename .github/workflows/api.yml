name: Daily API 

on:
  schedule:
    - cron: '30 0 * * *'   # æ¯å¤© 00:00 UTCï¼ˆå°ç£æ™‚é–“æ—©ä¸Š 8:00ï¼‰æ ¼å¼ï¼šåˆ† æ™‚ æ—¥ æœˆ æ˜ŸæœŸ
  workflow_dispatch:       # å…è¨±æ‰‹å‹•è§¸ç™¼

jobs:
  run-spider:
    runs-on: ubuntu-latest

    steps:  
    # æŠŠä½ é€™å€‹ repo çš„å…§å®¹ clone ä¸‹ä¾†ï¼Œæ‰èƒ½åŸ·è¡Œ .py æª”
    - name: Checkout code    
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'  # æŒ‡å®š Python ç‰ˆæœ¬

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run API 
      run: python api.py

    - name: Upload result (CSV)
      uses: actions/upload-artifact@v4        # å®˜æ–¹æä¾›çš„ä¸Šå‚³å·¥å…·
      with:
        name: api-result
        path: |
          api1.csv
          api2.csv

    - name: Commit Data Back To GitHub Repo
      run: |
        git config --global user.name "crawler-bot"
        git config --global user.email "hank710535@gmail.com"
        git add api1.csv api2.csv
        git commit -m "ğŸ“Š Daily API data update [auto]" || echo "No changes to commit"
        git push
